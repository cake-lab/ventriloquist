"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[493],{2493:function(e,t,n){n.r(t),n.d(t,{GesturesContext:function(){return we},LoadingContext:function(){return be},default:function(){return Le}});var r=n(4051),i=n.n(r),a=n(5893),o=n(7294),s=n(3253),l=n.n(s),c=function(e){var t=e.message;return t?(0,a.jsx)("div",{id:"loading-container",children:(0,a.jsx)("p",{id:"loading-text",children:t})}):(0,a.jsx)(a.Fragment,{})},u=n(9477),d=n(1411),m=n(9931),f=n(1217),h=n(9365);function g(e,t,n,r,i,a,o){try{var s=e[a](o),l=s.value}catch(c){return void n(c)}s.done?t(l):Promise.resolve(l).then(r,i)}function x(e){return function(){var t=this,n=arguments;return new Promise((function(r,i){var a=e.apply(t,n);function o(e){g(a,r,i,o,s,"next",e)}function s(e){g(a,r,i,o,s,"throw",e)}o(void 0)}))}}var p,v,y,b,w,L,k,R,j,H=[{name:"Default Girl",url:"/default/models/avatar_sample_a.vrm"},{name:"Default Boy",url:"/default/models/free_male.vrm"},{name:"Tail Girl",url:"/default/models/tail_girl.vrm"}],P=H[0],C=function(){var e=x(i().mark((function e(t){return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return console.log("Starting three.js scene"),t.style.width="".concat(window.innerWidth,"px"),t.style.height="".concat(window.innerHeight,"px"),t.width=t.clientWidth,t.height=t.clientHeight,(v=new u.xsS).background=new u.Ilk(15395562),y=new u.CP7({canvas:t}),b=new u.SUY,(w=new u.cPb(35,t.clientWidth/t.clientHeight,.1,1e3)).position.set(0,1.6,1),v.add(w),(k=new h.z(w,t)).screenSpacePanning=!0,k.target.set(0,1.4,0),k.update(),(L=new u.Ox3(16777215)).position.set(1,1,1).normalize(),v.add(L),e.next=21,N(P);case 21:I();case 22:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),I=function(){if(requestAnimationFrame(I),p){var e=b.getDelta();M&&R.update(e),p.update(e),y.render(v,w)}},N=function(){var e=x(i().mark((function e(t){var n,r,a;return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return p&&(console.log("Removing old model"),v.remove(p.scene)),console.log("Loading rig ".concat(t.url)),n=new f.E,e.next=5,n.loadAsync(t.url);case 5:return r=e.sent,m.ck.removeUnnecessaryJoints(r.scene),m.ck.removeUnnecessaryVertices(r.scene),e.next=10,m.n4.from(r);case 10:a=e.sent,v.add(a.scene),a.scene.rotation.y=Math.PI,p=a,(R=new u.Xcj(p.scene)).addEventListener("finished",(function(e){console.log("Animation finished"),E(!1)}));case 16:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),S={mixamorigHips:"hips",mixamorigSpine:"spine",mixamorigSpine1:"chest",mixamorigSpine2:"upperChest",mixamorigNeck:"neck",mixamorigHead:"head",mixamorigLeftShoulder:"leftShoulder",mixamorigLeftArm:"leftUpperArm",mixamorigLeftForeArm:"leftLowerArm",mixamorigLeftHand:"leftHand",mixamorigLeftHandThumb1:"leftThumbProximal",mixamorigLeftHandThumb2:"leftThumbIntermediate",mixamorigLeftHandThumb3:"leftThumbDistal",mixamorigLeftHandIndex1:"leftIndexProximal",mixamorigLeftHandIndex2:"leftIndexIntermediate",mixamorigLeftHandIndex3:"leftIndexDistal",mixamorigLeftHandMiddle1:"leftMiddleProximal",mixamorigLeftHandMiddle2:"leftMiddleIntermediate",mixamorigLeftHandMiddle3:"leftMiddleDistal",mixamorigLeftHandRing1:"leftRingProximal",mixamorigLeftHandRing2:"leftRingIntermediate",mixamorigLeftHandRing3:"leftRingDistal",mixamorigLeftHandPinky1:"leftLittleProximal",mixamorigLeftHandPinky2:"leftLittleIntermediate",mixamorigLeftHandPinky3:"leftLittleDistal",mixamorigRightShoulder:"rightShoulder",mixamorigRightArm:"rightUpperArm",mixamorigRightForeArm:"rightLowerArm",mixamorigRightHand:"rightHand",mixamorigRightHandPinky1:"rightLittleProximal",mixamorigRightHandPinky2:"rightLittleIntermediate",mixamorigRightHandPinky3:"rightLittleDistal",mixamorigRightHandRing1:"rightRingProximal",mixamorigRightHandRing2:"rightRingIntermediate",mixamorigRightHandRing3:"rightRingDistal",mixamorigRightHandMiddle1:"rightMiddleProximal",mixamorigRightHandMiddle2:"rightMiddleIntermediate",mixamorigRightHandMiddle3:"rightMiddleDistal",mixamorigRightHandIndex1:"rightIndexProximal",mixamorigRightHandIndex2:"rightIndexIntermediate",mixamorigRightHandIndex3:"rightIndexDistal",mixamorigRightHandThumb1:"rightThumbProximal",mixamorigRightHandThumb2:"rightThumbIntermediate",mixamorigRightHandThumb3:"rightThumbDistal",mixamorigLeftUpLeg:"leftUpperLeg",mixamorigLeftLeg:"leftLowerLeg",mixamorigLeftFoot:"leftFoot",mixamorigLeftToeBase:"leftToes",mixamorigRightUpLeg:"rightUpperLeg",mixamorigRightLeg:"rightLowerLeg",mixamorigRightFoot:"rightFoot",mixamorigRightToeBase:"rightToes"};function F(e,t,n,r,i,a,o){try{var s=e[a](o),l=s.value}catch(c){return void n(c)}s.done?t(l):Promise.resolve(l).then(r,i)}function A(e){return function(){var t=this,n=arguments;return new Promise((function(r,i){var a=e.apply(t,n);function o(e){F(a,r,i,o,s,"next",e)}function s(e){F(a,r,i,o,s,"throw",e)}o(void 0)}))}}function T(e,t){return null!=t&&"undefined"!==typeof Symbol&&t[Symbol.hasInstance]?t[Symbol.hasInstance](e):e instanceof t}var D=[{name:"Capoeira",url:"https://cdn.glitch.global/b233b4ea-cf6c-403a-bb68-82babee52d57/Capoeira%20(1).fbx?v=1642556259178"},{name:"Gangnam Style",url:"https://cdn.glitch.me/16b81be8-1f14-4a44-b78f-c3f6da842ee7%2FGangnam%20Style.fbx?v=1636708670740"}],M=!1,E=function(e){return M=e},U=[],O=function(){var e=A(i().mark((function e(t,n){var r;return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,B(n.url,t);case 2:r=e.sent,n.animation=r||void 0,n.owner||U.push(n);case 5:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}(),W=function(){var e=A(i().mark((function e(t,n){var r,a,o,s,l,c;return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(p){e.next=3;break}return console.error("Trying to reload gestures without an active VRM"),e.abrupt("return");case 3:console.log("Reloading default gestures"),U.length=0,r=!0,a=!1,o=void 0,e.prev=6,s=D[Symbol.iterator]();case 8:if(r=(l=s.next()).done){e.next=16;break}return c=l.value,t("Loading ".concat(c.name)),e.next=13,O(p,c);case 13:r=!0,e.next=8;break;case 16:e.next=22;break;case 18:e.prev=18,e.t0=e.catch(6),a=!0,o=e.t0;case 22:e.prev=22,e.prev=23,r||null==s.return||s.return();case 25:if(e.prev=25,!a){e.next=28;break}throw o;case 28:return e.finish(25);case 29:return e.finish(22);case 30:n(U);case 31:case"end":return e.stop()}}),e,null,[[6,18,22,30],[23,,25,29]])})));return function(t,n){return e.apply(this,arguments)}}(),B=function(){var e=A(i().mark((function e(t,n){var r,a,o,s,l,c,m,f,h,g,x,p,v,y,b,w,L,k,j;return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=new d.y,e.next=3,r.loadAsync(t);case 3:a=e.sent,console.log("Loaded FBX animation from ".concat(t)),console.log(a),o=u.m7l.findByName(a.animations,"mixamo.com"),console.log(o),s=[],l=!0,c=!1,m=void 0,e.prev=10,f=o.tracks[Symbol.iterator]();case 12:if(l=(h=f.next()).done){e.next=27;break}if(g=h.value,v=g.name.split("."),y=v[0],b=S[y],null!==(w=null===(p=null===(x=n.humanoid)||void 0===x?void 0:x.getBoneNode(b))||void 0===p?void 0:p.name)){e.next=22;break}return console.error("Error finding ".concat(b)),e.abrupt("return",null);case 22:L=v[1],T(g,u.iLg)?s.push(new u.iLg("".concat(w,".").concat(L),Array.from(g.times),Array.from(g.values).map((function(e,t){return t%2===0?-e:e})))):T(g,u.yC1)&&s.push(new u.yC1("".concat(w,".").concat(L),Array.from(g.times),Array.from(g.values).map((function(e,t){return.01*e}))));case 24:l=!0,e.next=12;break;case 27:e.next=33;break;case 29:e.prev=29,e.t0=e.catch(10),c=!0,m=e.t0;case 33:e.prev=33,e.prev=34,l||null==f.return||f.return();case 36:if(e.prev=36,!c){e.next=39;break}throw m;case 39:return e.finish(36);case 40:return e.finish(33);case 41:return k=new u.m7l(t,o.duration,s),(j=R.clipAction(k)).loop=u.jAl,e.abrupt("return",j);case 45:case"end":return e.stop()}}),e,null,[[10,29,33,41],[34,,36,40]])})));return function(t,n){return e.apply(this,arguments)}}(),_=function(){var e=(0,o.useContext)(we),t=e.gestures;e.setGestures;return(0,a.jsx)("div",{className:"control-panel",children:(0,a.jsxs)("div",{className:"control-content",children:[(0,a.jsx)("b",{children:"Gestures"}),(0,a.jsxs)("table",{children:[(0,a.jsx)("thead",{children:(0,a.jsxs)("tr",{children:[(0,a.jsx)("th",{children:"Name"}),(0,a.jsx)("th",{children:"Trigger"})]})}),(0,a.jsx)("tbody",{children:t.map((function(e,t){return(0,a.jsxs)("tr",{onClick:function(){!function(e){M=!0,j&&(console.log("Fading out of current animation"),j.fadeOut(1)),e.animation?(console.log("Starting ".concat(e.name)),(j=e.animation).fadeIn(1),j.reset(),j.play()):console.error("Attempting to play gesture which does not have an animation loaded")}(e)},className:"gesture-row",children:[(0,a.jsx)("td",{children:e.name}),(0,a.jsx)("td",{children:e.trigger||"none"})]},t)}))})]})]})})},z={content:{position:"absolute",top:"50%",left:"50%",right:"auto",bottom:"auto",marginRight:"-50%",transform:"translate(-50%, -50%)",backgroundColor:"white",border:"2px solid black",borderRadius:"10px"}},G=n(9669),V=n.n(G);function q(e,t,n,r,i,a,o){try{var s=e[a](o),l=s.value}catch(c){return void n(c)}s.done?t(l):Promise.resolve(l).then(r,i)}var Z=function(e){var t=e.onRequestClose,n=(0,o.useState)(null),r=n[0],s=n[1],l=(0,o.useRef)(null),c=(0,o.useRef)(null),u=function(){var e,t=(e=i().mark((function e(){var t,n;return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return s("Uploading models is not fully implemented yet :("),e.abrupt("return");case 8:return console.log({name:void 0,file:void 0}),t=new FormData,e.next=12,V().post("/api/models",t,{headers:{"content-type":"multipart/form-data"},onUploadProgress:function(e){console.log("Uploading: ".concat(e.loaded/e.total*100,"%"))}});case 12:n=e.sent,console.log(n);case 14:case"end":return e.stop()}}),e)})),function(){var t=this,n=arguments;return new Promise((function(r,i){var a=e.apply(t,n);function o(e){q(a,r,i,o,s,"next",e)}function s(e){q(a,r,i,o,s,"throw",e)}o(void 0)}))});return function(){return t.apply(this,arguments)}}();return(0,a.jsxs)("div",{className:"form",children:[(0,a.jsx)("h3",{children:"Upload Custom Model"}),(0,a.jsxs)("div",{className:"form-row",children:[(0,a.jsx)("label",{children:"Name"}),(0,a.jsx)("input",{type:"text",className:"form-control",ref:l})]}),(0,a.jsx)("div",{className:"form-row",children:(0,a.jsx)("input",{type:"file",className:"form-control-file",ref:c})}),(0,a.jsx)("hr",{}),(0,a.jsx)("div",{className:"form-row button-row",children:(0,a.jsxs)("div",{children:[(0,a.jsx)("button",{className:"btn btn-dark mx-1",onClick:u,children:"Upload"}),(0,a.jsx)("button",{className:"btn btn-outline-dark mx-1",onClick:t,children:"Cancel"})]})}),r&&(0,a.jsx)("p",{className:"text-danger",children:r})]})};function X(e,t,n,r,i,a,o){try{var s=e[a](o),l=s.value}catch(c){return void n(c)}s.done?t(l):Promise.resolve(l).then(r,i)}var J,Q=function(){var e=(0,o.useState)("solid"),t=e[0],n=e[1],r=(0,o.useContext)(be),s=(0,o.useContext)(we).setGestures,c=(0,o.useState)(!1),d=c[0],m=c[1],f=function(){m(!1)},h=function(){var e,t=(e=i().mark((function e(t){var n,a;return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=t.currentTarget.value,P.url!==n){e.next=4;break}return alert("".concat(P.url," already active")),e.abrupt("return");case 4:if(a=H.find((function(e){return e.url===n}))){e.next=8;break}return console.error("Couldn't find that model"),e.abrupt("return");case 8:return r("Loading ".concat(a.name)),e.next=11,N(a);case 11:return r("Generating gestures"),e.next=14,W(r,s);case 14:r(null);case 15:case"end":return e.stop()}}),e)})),function(){var t=this,n=arguments;return new Promise((function(r,i){var a=e.apply(t,n);function o(e){X(a,r,i,o,s,"next",e)}function s(e){X(a,r,i,o,s,"throw",e)}o(void 0)}))});return function(e){return t.apply(this,arguments)}}();return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(l(),{isOpen:d,onRequestClose:f,style:z,children:(0,a.jsx)(Z,{onRequestClose:f})}),(0,a.jsx)("div",{className:"control-panel",children:(0,a.jsxs)("div",{className:"control-content",children:[(0,a.jsx)("b",{children:"Avatar"}),(0,a.jsxs)("div",{style:{display:"flex"},children:[(0,a.jsx)("select",{className:"form-select",onChange:h,children:(0,a.jsx)("optgroup",{label:"Default",children:H.map((function(e){return(0,a.jsx)("option",{value:e.url,children:e.name},e.url)}))})}),(0,a.jsx)("button",{className:"btn btn-dark mx-1",onClick:function(){m(!0)},children:"New"})]}),(0,a.jsx)("hr",{}),(0,a.jsx)("b",{children:"Background"}),(0,a.jsxs)("div",{className:"vbox",children:[(0,a.jsxs)("div",{className:"hbox",children:[(0,a.jsx)("input",{type:"radio",className:"form-check-input mx-2",name:"background",defaultChecked:!0,onChange:function(e){n(e.currentTarget.value?"solid":"transparent"),e&&(v.background=new u.Ilk(document.getElementById("solidColorPicker").value))}}),(0,a.jsx)("p",{children:"Solid color"}),(0,a.jsx)("input",{id:"solidColorPicker",type:"color",className:"mx-2",defaultValue:"#eaeaea",onChange:function(e){"solid"===t&&(v.background=new u.Ilk(e.currentTarget.value))}}),(0,a.jsx)("div",{style:{flex:"1"}})]}),(0,a.jsxs)("div",{className:"hbox",children:[(0,a.jsx)("input",{type:"radio",className:"form-check-input mx-2",name:"background",onChange:function(e){n(e.currentTarget.value?"transparent":"solid"),e.currentTarget.value&&(v.background=null)}}),(0,a.jsx)("p",{children:"Transparent"})]})]})]})})]})},Y=function(e){var t=e.cameraCanvasRef,n=e.style;return(0,a.jsxs)("div",{id:"ui-container",style:n,children:[(0,a.jsx)(a.Fragment,{}),(0,a.jsxs)("div",{className:"hbox",children:[(0,a.jsxs)("div",{className:"vbox",children:[(0,a.jsx)("canvas",{ref:t,id:"camera-canvas"}),(0,a.jsx)(Q,{})]}),(0,a.jsx)("div",{style:{flex:"1"}}),(0,a.jsxs)("div",{className:"vbox",children:[(0,a.jsx)(_,{}),(0,a.jsx)("div",{style:{display:"flex",justifyContent:"center",alignItems:"center"},children:(0,a.jsx)("i",{children:"Hint: Click the screen to toggle streamer mode"})})]})]})]})},K=function(e,t){return new Promise((function(n){var r=function(){e.removeEventListener(t,r),n(void 0)};e.addEventListener(t,r)}))};function $(e,t,n,r,i,a,o){try{var s=e[a](o),l=s.value}catch(c){return void n(c)}s.done?t(l):Promise.resolve(l).then(r,i)}var ee,te,ne=function(){var e,t=(e=i().mark((function e(t,n){var r;return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!J){e.next=3;break}return console.log("Video already started"),e.abrupt("return",!1);case 3:return console.log("Requesting webcam access"),e.prev=4,e.next=7,navigator.mediaDevices.getUserMedia({video:{width:{min:1024,ideal:1280,max:1920},height:{min:576,ideal:720,max:1080}},audio:!1});case 7:return J=e.sent,t.srcObject=J,e.next=11,K(t,"loadeddata");case 11:return r=t.videoWidth/t.videoHeight,n.style.height="".concat(n.clientWidth/r,"px"),e.abrupt("return",!1);case 16:return e.prev=16,e.t0=e.catch(4),e.abrupt("return",!0);case 19:case"end":return e.stop()}}),e,null,[[4,16]])})),function(){var t=this,n=arguments;return new Promise((function(r,i){var a=e.apply(t,n);function o(e){$(a,r,i,o,s,"next",e)}function s(e){$(a,r,i,o,s,"throw",e)}o(void 0)}))});return function(e,n){return t.apply(this,arguments)}}(),re=n(7135),ie=n(5423),ae=n(4141),oe=n(2779),se=["RightUpperArm","RightLowerArm","LeftUpperArm","LeftLowerArm","RightUpperLeg","RightLowerLeg","LeftUpperLeg","LeftLowerLeg"],le=["LeftRingProximal","LeftRingIntermediate","LeftRingDistal","LeftIndexProximal","LeftIndexIntermediate","LeftIndexDistal","LeftMiddleProximal","LeftMiddleIntermediate","LeftMiddleDistal","LeftThumbProximal","LeftThumbDistal","LeftLittleProximal","LeftLittleIntermediate","LeftLittleDistal"],ce=["RightRingProximal","RightRingIntermediate","RightRingDistal","RightIndexProximal","RightIndexIntermediate","RightIndexDistal","RightMiddleProximal","RightMiddleIntermediate","RightMiddleDistal","RightThumbProximal","RightThumbDistal","RightLittleProximal","RightLittleIntermediate","RightLittleDistal"],ue=function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{x:0,y:0,z:0},r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1,i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:.3;if(e){var a=e.humanoid.getBoneNode(m.wZ.HumanoidBoneName[t]);if(a){var o=new u.USm(n.x*r,n.y*r,n.z*r),s=(new u._fP).setFromEuler(o);a.quaternion.slerp(s,i)}else console.error("VRM part ".concat(t," not found"))}},de=new u.USm,me=function(e,t){ue(e,"Hips",t.Hips.rotation,.7),function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{x:0,y:0,z:0},r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1,i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:.3;if(e){var a=e.humanoid.getBoneNode(m.wZ.HumanoidBoneName[t]);if(a){var o=new u.Pa4(n.x*r,n.y*r,n.z*r);a.position.lerp(o,i)}else console.error("VRM part ".concat(t," not found"))}}(e,"Hips",{x:-t.Hips.position.x,y:t.Hips.position.y+1,z:-t.Hips.position.z},1,.07),ue(e,"Chest",t.Spine,.25,.3),ue(e,"Spine",t.Spine,.45,.3);var n=!0,r=!1,i=void 0;try{for(var a,o=se[Symbol.iterator]();!(n=(a=o.next()).done);n=!0){var s=a.value;ue(e,s,t[s],1,.3)}}catch(l){r=!0,i=l}finally{try{n||null==o.return||o.return()}finally{if(r)throw i}}},fe=function(e,t,n){if(e){var r=t.faceLandmarks,i=t.ea,a=t.poseLandmarks,o=t.leftHandLandmarks,s=t.rightHandLandmarks;if(r)!function(e,t){if(e){ue(e,"Neck",t.head,.7);var n=e.blendShapeProxy,r=m.wZ.BlendShapePresetName;t.eye.l=oe.OW.lerp(oe.cQ.clamp(1-t.eye.l,0,1),n.getValue(r.Blink),.5),t.eye.r=oe.OW.lerp(oe.cQ.clamp(1-t.eye.r,0,1),n.getValue(r.Blink),.5),t.eye=oe.LR.stabilizeBlink(t.eye,t.head.y),n.setValue(r.Blink,t.eye.l);var i=!0,a=!1,o=void 0;try{for(var s,l=["A","E","I","O","U"][Symbol.iterator]();!(i=(s=l.next()).done);i=!0){var c=s.value;n.setValue(r[c],oe.OW.lerp(t.mouth.shape[c],n.getValue(r[c]),.5))}}catch(f){a=!0,o=f}finally{try{i||null==l.return||l.return()}finally{if(a)throw o}}var d=new u.USm(oe.OW.lerp(de.x,t.pupil.y,.4),oe.OW.lerp(de.y,t.pupil.x,.4),0,"XYZ");de.copy(d),e.lookAt.applyer.lookAt(d)}}(e,oe.LR.solve(r,{runtime:"mediapipe",video:n}));if(i&&a){var l=oe.DJ.solve(i,a,{runtime:"mediapipe",video:n});if(me(e,l),s)!function(e,t,n){ue(e,"LeftHand",{x:t.LeftWrist.x,y:t.LeftWrist.y,z:n.LeftHand.z});var r=!0,i=!1,a=void 0;try{for(var o,s=le[Symbol.iterator]();!(r=(o=s.next()).done);r=!0){var l=o.value;ue(e,l,t[l])}}catch(c){i=!0,a=c}finally{try{r||null==s.return||s.return()}finally{if(i)throw a}}}(e,oe.PA.solve(s,"Left"),l);if(o)!function(e,t,n){ue(e,"RightHand",{x:t.RightWrist.x,y:t.RightWrist.y,z:n.RightHand.z});var r=!0,i=!1,a=void 0;try{for(var o,s=ce[Symbol.iterator]();!(r=(o=s.next()).done);r=!0){var l=o.value;ue(e,l,t[l])}}catch(c){i=!0,a=c}finally{try{r||null==s.return||s.return()}finally{if(i)throw a}}}(e,oe.PA.solve(o,"Right"),l)}}};function he(e,t,n,r,i,a,o){try{var s=e[a](o),l=s.value}catch(c){return void n(c)}s.done?t(l):Promise.resolve(l).then(r,i)}function ge(e){return function(){var t=this,n=arguments;return new Promise((function(r,i){var a=e.apply(t,n);function o(e){he(a,r,i,o,s,"next",e)}function s(e){he(a,r,i,o,s,"throw",e)}o(void 0)}))}}var xe=!1,pe=function(){var e=ge(i().mark((function e(t,n){var r,a;return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(console.log("Starting mediapipe"),!ee||!te){e.next=6;break}return console.log("Mediapipe already started, using current instance"),xe=!0,t.dispatchEvent(new Event("started")),e.abrupt("return");case 6:if(t.width=t.clientWidth,t.height=t.clientHeight,r=t.getContext("2d"),a=function(e){xe||(xe=!0,console.log("Dispatching mediapipe start event"),t.dispatchEvent(new Event("started"))),ve(e,t,r),M||p&&fe(p,e,n)},ee||((ee=new ae.Holistic({locateFile:function(e){return"https://cdn.jsdelivr.net/npm/@mediapipe/holistic@0.5.1635989137/".concat(e)}})).setOptions({refineFaceLandmarks:!0}),ee.onResults(a)),te){e.next=15;break}return te=new re.Camera(n,{onFrame:ge(i().mark((function e(){return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,ee.send({image:n});case 2:case"end":return e.stop()}}),e)})))}),e.next=15,te.start();case 15:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}(),ve=(function(){var e=ge(i().mark((function e(){return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!te){e.next=4;break}return console.log("Stopping mediapipe"),e.next=4,te.stop();case 4:xe=!1;case 5:case"end":return e.stop()}}),e)})))}(),function(e,t,n){n.save(),n.clearRect(0,0,t.width,t.height),n.drawImage(e.image,0,0,t.width,t.height),(0,ie.drawConnectors)(n,e.faceLandmarks,ae.FACEMESH_TESSELATION,{color:"#FFFFFF50",lineWidth:1}),(0,ie.drawConnectors)(n,e.poseLandmarks,ae.POSE_CONNECTIONS,{color:"#FFFFFF",lineWidth:1}),(0,ie.drawConnectors)(n,e.leftHandLandmarks,ae.HAND_CONNECTIONS,{color:"#FFFFFF",lineWidth:1}),(0,ie.drawConnectors)(n,e.rightHandLandmarks,ae.HAND_CONNECTIONS,{color:"#FFFFFF",lineWidth:1}),n.restore()});function ye(e,t,n,r,i,a,o){try{var s=e[a](o),l=s.value}catch(c){return void n(c)}s.done?t(l):Promise.resolve(l).then(r,i)}l().setAppElement(document.getElementById("__next"));var be=o.createContext((function(e){})),we=o.createContext({gestures:[],setGestures:function(e){}}),Le=function(){var e=(0,o.useState)(null),t=e[0],n=e[1],r=(0,o.useState)([]),s=r[0],l=r[1],u=(0,o.useState)(null),d=(u[0],u[1]),m=(0,o.useRef)(null),f=(0,o.useRef)(null),h=(0,o.useRef)(null),g=(0,o.useState)(!1),x=g[0],p=g[1];return(0,o.useEffect)((function(){var e=function(){var e,t=(e=i().mark((function e(){return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return console.log("Beginning post-DOM-render logic"),n("Setting up webcam"),e.next=4,ne(m.current,f.current);case 4:if(!e.sent){e.next=7;break}return d("Couldn't access webcam"),e.abrupt("return");case 7:return n("Setting up three.js scene"),e.next=10,C(h.current);case 10:return n("Loading gestures"),e.next=13,W((function(e){return n(e)}),(function(e){return l(e)}));case 13:return n("Starting mediapipe"),e.next=16,pe(f.current,m.current);case 16:return n("Waiting for mediapipe"),e.next=19,K(f.current,"started");case 19:n(null);case 20:case"end":return e.stop()}}),e)})),function(){var t=this,n=arguments;return new Promise((function(r,i){var a=e.apply(t,n);function o(e){ye(a,r,i,o,s,"next",e)}function s(e){ye(a,r,i,o,s,"throw",e)}o(void 0)}))});return function(){return t.apply(this,arguments)}}();e()}),[]),(0,a.jsx)(be.Provider,{value:function(e){return n(e)},children:(0,a.jsxs)(we.Provider,{value:{gestures:s,setGestures:function(e){return l(e)}},children:[c&&(0,a.jsx)(c,{message:t}),(0,a.jsx)(Y,{style:{visibility:x?"hidden":"visible"},cameraCanvasRef:f}),(0,a.jsx)("video",{ref:m,id:"camera-video",autoPlay:!0}),(0,a.jsx)("canvas",{ref:h,onClick:function(){return p((function(e){return!e})),!1}})]})})}}}]);